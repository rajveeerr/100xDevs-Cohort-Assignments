<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balanz.io</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.7/axios.min.js"></script>
    <script src="https://kit.fontawesome.com/b6fe51c8e7.js" crossorigin="anonymous"></script>
</head>
<body>

    <!-- <input type="text" placeholder="Enter your Task"><button onclick="addTodo()">Add Todo</button>
    <div class="todos"></div> -->

    <div class="navbar">
        <div class="logo"><a href="landing.html"><span class="b">B</span>Balanz<span class="stylize">.</span><span style="">io</span></a></div>
        <div class="socials">
            <a href="https://x.com/RajveeerrSingh" class="twitter-btn"><i class="fa-brands fa-x-twitter"></i> Twitter</a>
            <a href="https://github.com/rajveeerr" class="github-btn"><i class="fa-brands fa-github"></i> Github</a>
        </div>
    </div>
    <div class="container">
        <aside class="sidebar">

            <div class="sidebar-header">
                <div class="user-info" onclick="logoutMenu()">
                    <img class="profileImg" src="/3.jpg"><div class="acc-details">
                        <p class="name">Rajveer Singh</p>
                        <p class="username">@major</p>
                    </div>
                </div>
                <i class="fa-solid fa-arrow-right-arrow-left" onclick="collapse()"></i>
            </div>
          
            <div class="menu">
                <div class="add-task-btn menu-item"><i class="fa-solid fa-circle-plus"></i>Add Task</div>
                <div class="all-task menu-item"><i class="fa-regular fa-calendar-check"></i> All Tasks</div>
                <div class="completed-task menu-item"><i class="fa-solid fa-square-check"></i> Completed</div>
                <div class="pending-task menu-item"><i class="fa-solid fa-hourglass-half"></i> In Progress</div>
            </div>

            <div class="logout">
                <a href="/" class="logout-btn" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
            </div>

        </aside>
    
        <!-- Main Content -->
        <main class="main-content">
          <!-- Task Input -->
          <section class="task-input">
            <input type="text" placeholder="Add a new task" class="new-task-input">
            <button class="add-task-btn">Add</button>
          </section>
    
          <!-- Task List -->
          <section class="task-list">
            <div class="task-item">
              <input type="checkbox">
              <div class="task-details">
                <span class="task-title">Complete the UI design</span>
                <span class="task-date">Due Tomorrow</span>
              </div>
            </div>
    
            <div class="task-item">
              <input type="checkbox">
              <div class="task-details">
                <span class="task-title">Review project milestones</span>
                <span class="task-date">Due in 3 Days</span>
              </div>
            </div>
    
            <div class="task-item">
              <input type="checkbox">
              <div class="task-details">
                <span class="task-title">Submit final report</span>
                <span class="task-date">Due Next Week</span>
              </div>
            </div>
          </section>
        </main>
      </div>


    <script>

        async function loggedin(){
            let token=localStorage.getItem("token");
            try{
                let response=await axios.get("http://localhost:3000/me",{
                    headers: {
                        authorization: token
                    }
                });
                userData=response.data;
                alert(`${userData.name} logged in!!!`)
                // if(userData.name){
                    return true;
                // }
            }
            catch(err){
                alert("Not logged in! Redirecting to login page");
                return false;
            }
        }
        
    loggedin().then((data)=>{
        if(!data){
            window.location.href = '/login';
        }
    })     
    let todos=[];  //this is state variable
    let ctr=1;
    function addTodo(){
        todos.push({
            title: document.querySelector("input").value,
            id: `${ctr}`,
            editId: `edit${ctr}`,
            deleteId: `del${ctr}`,
            isDone: false
        });
        ctr++;
        if(document.querySelector("input").value){
            render();
        }
        else{
            alert("Enter The Task!!!!!!!!")
        }
        document.querySelector("input").value='';
    }

    function deleteTodo(index){
        // todos.splice(index,1); //theres a better way to do this
        todos= todos.filter((obj)=>{if(obj.id!=index){return obj}});
        render();
    }

    function editTodo(index){
        span=document.getElementById(`todo${index}`);
        editbtn=document.getElementById(`edit${index}`)
 
        span.setAttribute("contentEditable","true");
        editbtn.style.display="none";
        span.style.border="1px solid black";
        let save=document.createElement("button");
        save.innerHTML="Save";
        let cancel=document.createElement("button");
        cancel.innerHTML="Cancel"
        span.parentNode.appendChild(save);
        span.parentNode.appendChild(cancel);
        cancel.addEventListener("click",()=>{render()});

        save.addEventListener("click",()=>{
            editedText=span.textContent;
            for(let i=0;i<todos.length;i++){
                if(todos[i].id==index){
                    console.log("done")
                    todos[i].title=editedText;
                }
            }
            render();
        })
    }

    function isCompleted(ele,index){
        // box=document.getElementById(`check${index}`);
        if(ele.checked){
            for(let i=0;i<todos.length;i++){
                if(todos[i].id===index){
                    todos[i].isDone=true;
                    break;
                }
            }
        }
        else{
            for(let i=0;i<todos.length;i++){
                if(todos[i].id===index){
                    todos[i].isDone=false;
                    break;
                }
            }
                
        }
        render();
        console.log(todos)
    }
  

    //this is component
    function todoComponent(todo){
        
        let div=document.createElement("div");

        let checkbox=document.createElement("input");
        checkbox.id="check"+todo.id;
        checkbox.type='checkbox';
        checkbox.onchange= ()=>{isCompleted(checkbox,todo.id)};
        checkbox.checked = todo.isDone;

        let span=document.createElement("span");
        span.id="todo"+todo.id;
        span.innerHTML=todo.title;

        let edit=document.createElement("button");
        edit.id="edit"+todo.id;
        edit.setAttribute("onclick",`editTodo(${todo.id})`);
        edit.innerHTML="Edit";

        let btn=document.createElement("button");
        // btn.id=todo.deleteId;
        btn.setAttribute("onclick",`deleteTodo(${todo.id})`);
        btn.innerHTML="Delete";

        div.appendChild(checkbox);
        div.appendChild(span);
        div.appendChild(btn);
        div.appendChild(edit);

        return div;
    }

    function render(){
        parent=document.querySelector(".todos");
        parent.innerHTML="";
        for(let i=0;i<todos.length;i++){    

            parent.appendChild(todoComponent(todos[i]));
            span=document.getElementById(`todo${todos[i].id}`);
            if(todos[i].isDone){
                span.style.textDecoration="line-through";
                // console.log(span)
            }
            else{
                span.style.textDecoration="none";
                // console.log(span)
            }
    }
    }
   </script>
</body>
</html>